!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,i,e){i||alert("No callback specified");const r=t.tileSet,s=t.clip;if(this.loadCallback=i,this.errorCallback=e,t.z>r.maxZoom){const i=Math.pow(2,t.z-r.maxZoom);this.x=Math.floor(t.x/i),this.y=Math.floor(t.y/i),this.z=r.maxZoom;const e=r.divisions,n=e*(t.x%i)/i,a=(e+1)*(e*(t.y%i))/i;s.dtmOffset=a+n,s.dtmWidth=r.divisions+1}else this.x=t.x,this.y=t.y,this.z=t.z,s.dtmOffset=0;this.tileFile=r.directory+"/"+this.z+"/DTM-"+this.x+"-"+this.y+".bin"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),e=1;e<arguments.length;e++){var r=arguments[e];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])}return i}),t.prototype.constructor=t,t.prototype.load=function(){const t=this,i=new XMLHttpRequest;return i.addEventListener("load",(function(){200===i.status?t.loadCallback(i.response):t.errorCallback(i.response)})),i.addEventListener("error",this.errorCallback),i.open("GET",this.tileFile),i.responseType="arraybuffer",i.send(),!0};for(var i=[],e=0;e<256;e++)i[e]=(e<16?"0":"")+e.toString(16);var r={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255]+"-"+i[255&e]+i[e>>8&255]+"-"+i[e>>16&15|64]+i[e>>24&255]+"-"+i[63&r|128]+i[r>>8&255]+"-"+i[r>>16&255]+i[r>>24&255]+i[255&s]+i[s>>8&255]+i[s>>16&255]+i[s>>24&255]).toUpperCase()},clamp:function(t,i,e){return Math.max(i,Math.min(e,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,e,r,s){return r+(t-i)*(s-r)/(e-i)},lerp:function(t,i,e){return(1-e)*t+e*i},smoothstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*(3-2*t)},smootherstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*r.DEG2RAD},radToDeg:function(t){return t*r.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,e,r,s){var n=Math.cos,a=Math.sin,o=n(e/2),h=a(e/2),u=n((i+r)/2),c=a((i+r)/2),l=n((i-r)/2),m=a((i-r)/2),d=n((r-i)/2),y=a((r-i)/2);"XYX"===s?t.set(o*c,h*l,h*m,o*u):"YZY"===s?t.set(h*m,o*c,h*l,o*u):"ZXZ"===s?t.set(h*l,h*m,o*c,o*u):"XZX"===s?t.set(o*c,h*y,h*d,o*u):"YXY"===s?t.set(h*d,o*c,h*y,o*u):"ZYZ"===s?t.set(h*y,h*d,o*c,o*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function s(t,i,e,r){this._x=t||0,this._y=i||0,this._z=e||0,this._w=void 0!==r?r:1}Object.assign(s,{slerp:function(t,i,e,r){return e.copy(t).slerp(i,r)},slerpFlat:function(t,i,e,r,s,n,a){var o=e[r+0],h=e[r+1],u=e[r+2],c=e[r+3],l=s[n+0],m=s[n+1],d=s[n+2],y=s[n+3];if(c!==y||o!==l||h!==m||u!==d){var f=1-a,p=o*l+h*m+u*d+c*y,x=p>=0?1:-1,g=1-p*p;if(g>Number.EPSILON){var v=Math.sqrt(g),b=Math.atan2(v,p*x);f=Math.sin(f*b)/v,a=Math.sin(a*b)/v}var w=a*x;if(o=o*f+l*w,h=h*f+m*w,u=u*f+d*w,c=c*f+y*w,f===1-a){var M=1/Math.sqrt(o*o+h*h+u*u+c*c);o*=M,h*=M,u*=M,c*=M}}t[i]=o,t[i+1]=h,t[i+2]=u,t[i+3]=c}}),Object.defineProperties(s.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(s.prototype,{isQuaternion:!0,set:function(t,i,e,r){return this._x=t,this._y=i,this._z=e,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var e=t._x,r=t._y,s=t._z,n=t.order,a=Math.cos,o=Math.sin,h=a(e/2),u=a(r/2),c=a(s/2),l=o(e/2),m=o(r/2),d=o(s/2);return"XYZ"===n?(this._x=l*u*c+h*m*d,this._y=h*m*c-l*u*d,this._z=h*u*d+l*m*c,this._w=h*u*c-l*m*d):"YXZ"===n?(this._x=l*u*c+h*m*d,this._y=h*m*c-l*u*d,this._z=h*u*d-l*m*c,this._w=h*u*c+l*m*d):"ZXY"===n?(this._x=l*u*c-h*m*d,this._y=h*m*c+l*u*d,this._z=h*u*d+l*m*c,this._w=h*u*c-l*m*d):"ZYX"===n?(this._x=l*u*c-h*m*d,this._y=h*m*c+l*u*d,this._z=h*u*d-l*m*c,this._w=h*u*c+l*m*d):"YZX"===n?(this._x=l*u*c+h*m*d,this._y=h*m*c+l*u*d,this._z=h*u*d-l*m*c,this._w=h*u*c-l*m*d):"XZY"===n&&(this._x=l*u*c-h*m*d,this._y=h*m*c-l*u*d,this._z=h*u*d+l*m*c,this._w=h*u*c+l*m*d),!1!==i&&this._onChangeCallback(),this},setFromAxisAngle:function(t,i){var e=i/2,r=Math.sin(e);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(e),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var i,e=t.elements,r=e[0],s=e[4],n=e[8],a=e[1],o=e[5],h=e[9],u=e[2],c=e[6],l=e[10],m=r+o+l;return m>0?(i=.5/Math.sqrt(m+1),this._w=.25/i,this._x=(c-h)*i,this._y=(n-u)*i,this._z=(a-s)*i):r>o&&r>l?(i=2*Math.sqrt(1+r-o-l),this._w=(c-h)/i,this._x=.25*i,this._y=(s+a)/i,this._z=(n+u)/i):o>l?(i=2*Math.sqrt(1+o-r-l),this._w=(n-u)/i,this._x=(s+a)/i,this._y=.25*i,this._z=(h+c)/i):(i=2*Math.sqrt(1+l-r-o),this._w=(a-s)/i,this._x=(n+u)/i,this._y=(h+c)/i,this._z=.25*i),this._onChangeCallback(),this},setFromUnitVectors:function(t,i){var e=t.dot(i)+1;return e<1e-6?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=e):(this._x=0,this._y=-t.z,this._z=t.y,this._w=e)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=e),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(r.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,i){var e=this.angleTo(t);if(0===e)return this;var r=Math.min(1,i/e);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var e=t._x,r=t._y,s=t._z,n=t._w,a=i._x,o=i._y,h=i._z,u=i._w;return this._x=e*u+n*a+r*h-s*o,this._y=r*u+n*o+s*a-e*h,this._z=s*u+n*h+e*o-r*a,this._w=n*u-e*a-r*o-s*h,this._onChangeCallback(),this},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var e=this._x,r=this._y,s=this._z,n=this._w,a=n*t._w+e*t._x+r*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=n,this._x=e,this._y=r,this._z=s,this;var o=1-a*a;if(o<=Number.EPSILON){var h=1-i;return this._w=h*n+i*this._w,this._x=h*e+i*this._x,this._y=h*r+i*this._y,this._z=h*s+i*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(o),c=Math.atan2(u,a),l=Math.sin((1-i)*c)/u,m=Math.sin(i*c)/u;return this._w=n*l+this._w*m,this._x=e*l+this._x*m,this._y=r*l+this._y*m,this._z=s*l+this._z*m,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var n=new o,a=new s;function o(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0}Object.assign(o.prototype,{isVector3:!0,set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(a.setFromEuler(t))},applyAxisAngle:function(t,i){return this.applyQuaternion(a.setFromAxisAngle(t,i))},applyMatrix3:function(t){var i=this.x,e=this.y,r=this.z,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6]*r,this.y=s[1]*i+s[4]*e+s[7]*r,this.z=s[2]*i+s[5]*e+s[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var i=this.x,e=this.y,r=this.z,s=t.elements,n=1/(s[3]*i+s[7]*e+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*e+s[8]*r+s[12])*n,this.y=(s[1]*i+s[5]*e+s[9]*r+s[13])*n,this.z=(s[2]*i+s[6]*e+s[10]*r+s[14])*n,this},applyQuaternion:function(t){var i=this.x,e=this.y,r=this.z,s=t.x,n=t.y,a=t.z,o=t.w,h=o*i+n*r-a*e,u=o*e+a*i-s*r,c=o*r+s*e-n*i,l=-s*i-n*e-a*r;return this.x=h*o+l*-s+u*-a-c*-n,this.y=u*o+l*-n+c*-s-h*-a,this.z=c*o+l*-a+h*-n-u*-s,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var i=this.x,e=this.y,r=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*r,this.y=s[1]*i+s[5]*e+s[9]*r,this.z=s[2]*i+s[6]*e+s[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this},clampLength:function(t,i){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},cross:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)},crossVectors:function(t,i){var e=t.x,r=t.y,s=t.z,n=i.x,a=i.y,o=i.z;return this.x=r*o-s*a,this.y=s*n-e*o,this.z=e*a-r*n,this},projectOnVector:function(t){var i=t.lengthSq();if(0===i)return this.set(0,0,0);var e=t.dot(this)/i;return this.copy(t).multiplyScalar(e)},projectOnPlane:function(t){return n.copy(this).projectOnVector(t),this.sub(n)},reflect:function(t){return this.sub(n.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;var e=this.dot(t)/i;return Math.acos(r.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y,r=this.z-t.z;return i*i+e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,i,e){var r=Math.sin(i)*t;return this.x=r*Math.sin(e),this.y=Math.cos(i)*t,this.z=r*Math.cos(e),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,i,e){return this.x=t*Math.sin(i),this.y=e,this.z=t*Math.cos(i),this},setFromMatrixPosition:function(t){var i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=e,this.z=r,this},setFromMatrixColumn:function(t,i){return this.fromArray(t.elements,4*i)},setFromMatrix3Column:function(t,i){return this.fromArray(t.elements,3*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromBufferAttribute:function(t,i,e){return void 0!==e&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}});var h=[new o,new o,new o,new o,new o,new o,new o,new o],u=new o,c=new w,l=new o,m=new o,d=new o,y=new o,f=new o,p=new o,x=new o,g=new o,v=new o,b=new o;function w(t,i){this.min=void 0!==t?t:new o(1/0,1/0,1/0),this.max=void 0!==i?i:new o(-1/0,-1/0,-1/0)}function M(t,i,e,r,s){var n,a;for(n=0,a=t.length-3;n<=a;n+=3){b.fromArray(t,n);var o=s.x*Math.abs(b.x)+s.y*Math.abs(b.y)+s.z*Math.abs(b.z),h=i.dot(b),u=e.dot(b),c=r.dot(b);if(Math.max(-Math.max(h,u,c),Math.min(h,u,c))>o)return!1}return!0}function z(){}function _(t,i,e,r){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==r?r:1}function A(t,i){this.x=t||0,this.y=i||0}Object.assign(w.prototype,{isBox3:!0,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromArray:function(t){for(var i=1/0,e=1/0,r=1/0,s=-1/0,n=-1/0,a=-1/0,o=0,h=t.length;o<h;o+=3){var u=t[o],c=t[o+1],l=t[o+2];u<i&&(i=u),c<e&&(e=c),l<r&&(r=l),u>s&&(s=u),c>n&&(n=c),l>a&&(a=l)}return this.min.set(i,e,r),this.max.set(s,n,a),this},setFromBufferAttribute:function(t){for(var i=1/0,e=1/0,r=1/0,s=-1/0,n=-1/0,a=-1/0,o=0,h=t.count;o<h;o++){var u=t.getX(o),c=t.getY(o),l=t.getZ(o);u<i&&(i=u),c<e&&(e=c),l<r&&(r=l),u>s&&(s=u),c>n&&(n=c),l>a&&(a=l)}return this.min.set(i,e,r),this.max.set(s,n,a),this},setFromPoints:function(t){this.makeEmpty();for(var i=0,e=t.length;i<e;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,i){var e=u.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new o),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new o),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var i=t.geometry;void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),c.copy(i.boundingBox),c.applyMatrix4(t.matrixWorld),this.expandByPoint(c.min),this.expandByPoint(c.max));for(var e=t.children,r=0,s=e.length;r<s;r++)this.expandByObject(e[r]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .getParameter() target is now required"),i=new o),i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,u),u.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var i,e;return t.normal.x>0?(i=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),i<=-t.constant&&e>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(x),g.subVectors(this.max,x),l.subVectors(t.a,x),m.subVectors(t.b,x),d.subVectors(t.c,x),y.subVectors(m,l),f.subVectors(d,m),p.subVectors(l,d);var i=[0,-y.z,y.y,0,-f.z,f.y,0,-p.z,p.y,y.z,0,-y.x,f.z,0,-f.x,p.z,0,-p.x,-y.y,y.x,0,-f.y,f.x,0,-p.y,p.x,0];return!!M(i,l,m,d,g)&&(!!M(i=[1,0,0,0,1,0,0,0,1],l,m,d,g)&&(v.crossVectors(y,f),M(i=[v.x,v.y,v.z],l,m,d,g)))},clampPoint:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .clampPoint() target is now required"),i=new o),i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return u.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(u).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()?this:(h[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),h[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),h[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),h[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),h[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),h[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),h[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),h[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(h),this)},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(z.prototype,{addEventListener:function(t,i){void 0===this._listeners&&(this._listeners={});var e=this._listeners;void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)},hasEventListener:function(t,i){if(void 0===this._listeners)return!1;var e=this._listeners;return void 0!==e[t]&&-1!==e[t].indexOf(i)},removeEventListener:function(t,i){if(void 0!==this._listeners){var e=this._listeners[t];if(void 0!==e){var r=e.indexOf(i);-1!==r&&e.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var i=this._listeners[t.type];if(void 0!==i){t.target=this;for(var e=i.slice(0),r=0,s=e.length;r<s;r++)e[r].call(this,t);t.target=null}}}}),Object.defineProperties(_.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(_.prototype,{isVector4:!0,set:function(t,i,e,r){return this.x=t,this.y=i,this.z=e,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var i=this.x,e=this.y,r=this.z,s=this.w,n=t.elements;return this.x=n[0]*i+n[4]*e+n[8]*r+n[12]*s,this.y=n[1]*i+n[5]*e+n[9]*r+n[13]*s,this.z=n[2]*i+n[6]*e+n[10]*r+n[14]*s,this.w=n[3]*i+n[7]*e+n[11]*r+n[15]*s,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},setAxisAngleFromRotationMatrix:function(t){var i,e,r,s,n=t.elements,a=n[0],o=n[4],h=n[8],u=n[1],c=n[5],l=n[9],m=n[2],d=n[6],y=n[10];if(Math.abs(o-u)<.01&&Math.abs(h-m)<.01&&Math.abs(l-d)<.01){if(Math.abs(o+u)<.1&&Math.abs(h+m)<.1&&Math.abs(l+d)<.1&&Math.abs(a+c+y-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;var f=(a+1)/2,p=(c+1)/2,x=(y+1)/2,g=(o+u)/4,v=(h+m)/4,b=(l+d)/4;return f>p&&f>x?f<.01?(e=0,r=.707106781,s=.707106781):(r=g/(e=Math.sqrt(f)),s=v/e):p>x?p<.01?(e=.707106781,r=0,s=.707106781):(e=g/(r=Math.sqrt(p)),s=b/r):x<.01?(e=.707106781,r=.707106781,s=0):(e=v/(s=Math.sqrt(x)),r=b/s),this.set(e,r,s,i),this}var w=Math.sqrt((d-l)*(d-l)+(h-m)*(h-m)+(u-o)*(u-o));return Math.abs(w)<.001&&(w=1),this.x=(d-l)/w,this.y=(h-m)/w,this.z=(u-o)/w,this.w=Math.acos((a+c+y-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this},clampLength:function(t,i){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},fromBufferAttribute:function(t,i,e){return void 0!==e&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}}),Object.defineProperties(A.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(A.prototype,{isVector2:!0,set:function(t,i){return this.x=t,this.y=i,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var i=this.x,e=this.y,r=t.elements;return this.x=r[0]*i+r[3]*e+r[6],this.y=r[1]*i+r[4]*e+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this},clampLength:function(t,i){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},fromBufferAttribute:function(t,i,e){return void 0!==e&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this},rotateAround:function(t,i){var e=Math.cos(i),r=Math.sin(i),s=this.x-t.x,n=this.y-t.y;return this.x=s*e-n*r+t.x,this.y=s*r+n*e+t.y,this}});var S={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},E={h:0,s:0,l:0},k={h:0,s:0,l:0};function T(t,i,e){return void 0===i&&void 0===e?this.set(t):this.setRGB(t,i,e)}function B(t,i,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?t+6*(i-t)*e:e<.5?i:e<2/3?t+6*(i-t)*(2/3-e):t}function O(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function C(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}Object.assign(T.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,e){return this.r=t,this.g=i,this.b=e,this},setHSL:function(t,i,e){if(t=r.euclideanModulo(t,1),i=r.clamp(i,0,1),e=r.clamp(e,0,1),0===i)this.r=this.g=this.b=e;else{var s=e<=.5?e*(1+i):e+i-e*i,n=2*e-s;this.r=B(n,s,t+1/3),this.g=B(n,s,t),this.b=B(n,s,t-1/3)}return this},setStyle:function(t){function i(i){void 0!==i&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var e;if(e=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,s=e[1],n=e[2];switch(s){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,i(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,i(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){var a=parseFloat(r[1])/360,o=parseInt(r[2],10)/100,h=parseInt(r[3],10)/100;return i(r[5]),this.setHSL(a,o,h)}}}else if(e=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u=e[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var i=S[t];return void 0!==i?this.setHex(i):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,i){return void 0===i&&(i=2),this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},copyLinearToGamma:function(t,i){void 0===i&&(i=2);var e=i>0?1/i:1;return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=O(t.r),this.g=O(t.g),this.b=O(t.b),this},copyLinearToSRGB:function(t){return this.r=C(t.r),this.g=C(t.g),this.b=C(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var i,e,r=this.r,s=this.g,n=this.b,a=Math.max(r,s,n),o=Math.min(r,s,n),h=(o+a)/2;if(o===a)i=0,e=0;else{var u=a-o;switch(e=h<=.5?u/(a+o):u/(2-a-o),a){case r:i=(s-n)/u+(s<n?6:0);break;case s:i=(n-r)/u+2;break;case n:i=(r-s)/u+4}i/=6}return t.h=i,t.s=e,t.l=h,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,i,e){return this.getHSL(E),E.h+=t,E.s+=i,E.l+=e,this.setHSL(E.h,E.s,E.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this},lerpHSL:function(t,i){this.getHSL(E),t.getHSL(k);var e=r.lerp(E.h,k.h,i),s=r.lerp(E.s,k.s,i),n=r.lerp(E.l,k.l,i);return this.setHSL(e,s,n),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,i){return void 0===i&&(i=0),this.r=t[i],this.g=t[i+1],this.b=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t},toJSON:function(){return this.getHex()}}),T.NAMES=S;var R=new o;function N(t,i,e){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=i,this.count=void 0!==t?t.length/i:0,this.normalized=!0===e,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function U(t,i,e){N.call(this,new Int8Array(t),i,e)}function V(t,i,e){N.call(this,new Uint8Array(t),i,e)}function F(t,i,e){N.call(this,new Uint8ClampedArray(t),i,e)}function q(t,i,e){N.call(this,new Int16Array(t),i,e)}function j(t,i,e){N.call(this,new Uint16Array(t),i,e)}function H(t,i,e){N.call(this,new Int32Array(t),i,e)}function W(t,i,e){N.call(this,new Uint32Array(t),i,e)}function P(t,i,e){N.call(this,new Float32Array(t),i,e)}function I(t,i,e){N.call(this,new Float64Array(t),i,e)}Object.defineProperty(N.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(N.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,i,e){t*=this.itemSize,e*=i.itemSize;for(var r=0,s=this.itemSize;r<s;r++)this.array[t+r]=i.array[e+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var i=this.array,e=0,r=0,s=t.length;r<s;r++){var n=t[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),n=new T),i[e++]=n.r,i[e++]=n.g,i[e++]=n.b}return this},copyVector2sArray:function(t){for(var i=this.array,e=0,r=0,s=t.length;r<s;r++){var n=t[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),n=new A),i[e++]=n.x,i[e++]=n.y}return this},copyVector3sArray:function(t){for(var i=this.array,e=0,r=0,s=t.length;r<s;r++){var n=t[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),n=new o),i[e++]=n.x,i[e++]=n.y,i[e++]=n.z}return this},copyVector4sArray:function(t){for(var i=this.array,e=0,r=0,s=t.length;r<s;r++){var n=t[r];void 0===n&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),n=new _),i[e++]=n.x,i[e++]=n.y,i[e++]=n.z,i[e++]=n.w}return this},applyMatrix3:function(t){for(var i=0,e=this.count;i<e;i++)R.x=this.getX(i),R.y=this.getY(i),R.z=this.getZ(i),R.applyMatrix3(t),this.setXYZ(i,R.x,R.y,R.z);return this},applyMatrix4:function(t){for(var i=0,e=this.count;i<e;i++)R.x=this.getX(i),R.y=this.getY(i),R.z=this.getZ(i),R.applyMatrix4(t),this.setXYZ(i,R.x,R.y,R.z);return this},applyNormalMatrix:function(t){for(var i=0,e=this.count;i<e;i++)R.x=this.getX(i),R.y=this.getY(i),R.z=this.getZ(i),R.applyNormalMatrix(t),this.setXYZ(i,R.x,R.y,R.z);return this},transformDirection:function(t){for(var i=0,e=this.count;i<e;i++)R.x=this.getX(i),R.y=this.getY(i),R.z=this.getZ(i),R.transformDirection(t),this.setXYZ(i,R.x,R.y,R.z);return this},set:function(t,i){return void 0===i&&(i=0),this.array.set(t,i),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,i){return this.array[t*this.itemSize]=i,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,i){return this.array[t*this.itemSize+1]=i,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,i){return this.array[t*this.itemSize+2]=i,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,i){return this.array[t*this.itemSize+3]=i,this},setXY:function(t,i,e){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=e,this},setXYZ:function(t,i,e,r){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=e,this.array[t+2]=r,this},setXYZW:function(t,i,e,r,s){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=e,this.array[t+2]=r,this.array[t+3]=s,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),U.prototype=Object.create(N.prototype),U.prototype.constructor=U,V.prototype=Object.create(N.prototype),V.prototype.constructor=V,F.prototype=Object.create(N.prototype),F.prototype.constructor=F,q.prototype=Object.create(N.prototype),q.prototype.constructor=q,j.prototype=Object.create(N.prototype),j.prototype.constructor=j,H.prototype=Object.create(N.prototype),H.prototype.constructor=H,W.prototype=Object.create(N.prototype),W.prototype.constructor=W,P.prototype=Object.create(N.prototype),P.prototype.constructor=P,I.prototype=Object.create(N.prototype),I.prototype.constructor=I;var D=new w;function Z(t,i){this.center=void 0!==t?t:new o,this.radius=void 0!==i?i:0}function X(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(Z.prototype,{set:function(t,i){return this.center.copy(t),this.radius=i,this},setFromPoints:function(t,i){var e=this.center;void 0!==i?e.copy(i):D.setFromPoints(t).getCenter(e);for(var r=0,s=0,n=t.length;s<n;s++)r=Math.max(r,e.distanceToSquared(t[s]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,i){var e=this.center.distanceToSquared(t);return void 0===i&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),i=new o),i.copy(t),e>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new w),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(X.prototype,{computeGroups:function(t){for(var i,e=[],r=void 0,s=t.faces,n=0;n<s.length;n++){var a=s[n];a.materialIndex!==r&&(r=a.materialIndex,void 0!==i&&(i.count=3*n-i.start,e.push(i)),i={start:3*n,materialIndex:r})}void 0!==i&&(i.count=3*n-i.start,e.push(i)),this.groups=e},fromGeometry:function(t){var i,e=t.faces,r=t.vertices,s=t.faceVertexUvs,n=s[0]&&s[0].length>0,a=s[1]&&s[1].length>0,o=t.morphTargets,h=o.length;if(h>0){i=[];for(var u=0;u<h;u++)i[u]={name:o[u].name,data:[]};this.morphTargets.position=i}var c,l=t.morphNormals,m=l.length;if(m>0){c=[];for(u=0;u<m;u++)c[u]={name:l[u].name,data:[]};this.morphTargets.normal=c}var d=t.skinIndices,y=t.skinWeights,f=d.length===r.length,p=y.length===r.length;r.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(u=0;u<e.length;u++){var x=e[u];this.vertices.push(r[x.a],r[x.b],r[x.c]);var g=x.vertexNormals;if(3===g.length)this.normals.push(g[0],g[1],g[2]);else{var v=x.normal;this.normals.push(v,v,v)}var b,w=x.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var M=x.color;this.colors.push(M,M,M)}if(!0===n)void 0!==(b=s[0][u])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new A,new A,new A));if(!0===a)void 0!==(b=s[1][u])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new A,new A,new A));for(var z=0;z<h;z++){var _=o[z].vertices;i[z].data.push(_[x.a],_[x.b],_[x.c])}for(z=0;z<m;z++){var S=l[z].vertexNormals[u];c[z].data.push(S.a,S.b,S.c)}f&&this.skinIndices.push(d[x.a],d[x.b],d[x.c]),p&&this.skinWeights.push(y[x.a],y[x.b],y[x.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var G=new o,Y=new tt,L=new o(0,0,0),Q=new o(1,1,1),J=new o,$=new o,K=new o;function tt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(tt.prototype,{isMatrix4:!0,set:function(t,i,e,r,s,n,a,o,h,u,c,l,m,d,y,f){var p=this.elements;return p[0]=t,p[4]=i,p[8]=e,p[12]=r,p[1]=s,p[5]=n,p[9]=a,p[13]=o,p[2]=h,p[6]=u,p[10]=c,p[14]=l,p[3]=m,p[7]=d,p[11]=y,p[15]=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new tt).fromArray(this.elements)},copy:function(t){var i=this.elements,e=t.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this},copyPosition:function(t){var i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this},extractBasis:function(t,i,e){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this},makeBasis:function(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this},extractRotation:function(t){var i=this.elements,e=t.elements,r=1/G.setFromMatrixColumn(t,0).length(),s=1/G.setFromMatrixColumn(t,1).length(),n=1/G.setFromMatrixColumn(t,2).length();return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=0,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=0,i[8]=e[8]*n,i[9]=e[9]*n,i[10]=e[10]*n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=this.elements,e=t.x,r=t.y,s=t.z,n=Math.cos(e),a=Math.sin(e),o=Math.cos(r),h=Math.sin(r),u=Math.cos(s),c=Math.sin(s);if("XYZ"===t.order){var l=n*u,m=n*c,d=a*u,y=a*c;i[0]=o*u,i[4]=-o*c,i[8]=h,i[1]=m+d*h,i[5]=l-y*h,i[9]=-a*o,i[2]=y-l*h,i[6]=d+m*h,i[10]=n*o}else if("YXZ"===t.order){var f=o*u,p=o*c,x=h*u,g=h*c;i[0]=f+g*a,i[4]=x*a-p,i[8]=n*h,i[1]=n*c,i[5]=n*u,i[9]=-a,i[2]=p*a-x,i[6]=g+f*a,i[10]=n*o}else if("ZXY"===t.order){f=o*u,p=o*c,x=h*u,g=h*c;i[0]=f-g*a,i[4]=-n*c,i[8]=x+p*a,i[1]=p+x*a,i[5]=n*u,i[9]=g-f*a,i[2]=-n*h,i[6]=a,i[10]=n*o}else if("ZYX"===t.order){l=n*u,m=n*c,d=a*u,y=a*c;i[0]=o*u,i[4]=d*h-m,i[8]=l*h+y,i[1]=o*c,i[5]=y*h+l,i[9]=m*h-d,i[2]=-h,i[6]=a*o,i[10]=n*o}else if("YZX"===t.order){var v=n*o,b=n*h,w=a*o,M=a*h;i[0]=o*u,i[4]=M-v*c,i[8]=w*c+b,i[1]=c,i[5]=n*u,i[9]=-a*u,i[2]=-h*u,i[6]=b*c+w,i[10]=v-M*c}else if("XZY"===t.order){v=n*o,b=n*h,w=a*o,M=a*h;i[0]=o*u,i[4]=-c,i[8]=h*u,i[1]=v*c+M,i[5]=n*u,i[9]=b*c-w,i[2]=w*c-b,i[6]=a*u,i[10]=M*c+v}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(L,t,Q)},lookAt:function(t,i,e){var r=this.elements;return K.subVectors(t,i),0===K.lengthSq()&&(K.z=1),K.normalize(),J.crossVectors(e,K),0===J.lengthSq()&&(1===Math.abs(e.z)?K.x+=1e-4:K.z+=1e-4,K.normalize(),J.crossVectors(e,K)),J.normalize(),$.crossVectors(K,J),r[0]=J.x,r[4]=$.x,r[8]=K.x,r[1]=J.y,r[5]=$.y,r[9]=K.y,r[2]=J.z,r[6]=$.z,r[10]=K.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var e=t.elements,r=i.elements,s=this.elements,n=e[0],a=e[4],o=e[8],h=e[12],u=e[1],c=e[5],l=e[9],m=e[13],d=e[2],y=e[6],f=e[10],p=e[14],x=e[3],g=e[7],v=e[11],b=e[15],w=r[0],M=r[4],z=r[8],_=r[12],A=r[1],S=r[5],E=r[9],k=r[13],T=r[2],B=r[6],O=r[10],C=r[14],R=r[3],N=r[7],U=r[11],V=r[15];return s[0]=n*w+a*A+o*T+h*R,s[4]=n*M+a*S+o*B+h*N,s[8]=n*z+a*E+o*O+h*U,s[12]=n*_+a*k+o*C+h*V,s[1]=u*w+c*A+l*T+m*R,s[5]=u*M+c*S+l*B+m*N,s[9]=u*z+c*E+l*O+m*U,s[13]=u*_+c*k+l*C+m*V,s[2]=d*w+y*A+f*T+p*R,s[6]=d*M+y*S+f*B+p*N,s[10]=d*z+y*E+f*O+p*U,s[14]=d*_+y*k+f*C+p*V,s[3]=x*w+g*A+v*T+b*R,s[7]=x*M+g*S+v*B+b*N,s[11]=x*z+g*E+v*O+b*U,s[15]=x*_+g*k+v*C+b*V,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},determinant:function(){var t=this.elements,i=t[0],e=t[4],r=t[8],s=t[12],n=t[1],a=t[5],o=t[9],h=t[13],u=t[2],c=t[6],l=t[10],m=t[14];return t[3]*(+s*o*c-r*h*c-s*a*l+e*h*l+r*a*m-e*o*m)+t[7]*(+i*o*m-i*h*l+s*n*l-r*n*m+r*h*u-s*o*u)+t[11]*(+i*h*c-i*a*m-s*n*c+e*n*m+s*a*u-e*h*u)+t[15]*(-r*a*u-i*o*c+i*a*l+r*n*c-e*n*l+e*o*u)},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t,this},setPosition:function(t,i,e){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=i,r[14]=e),this},getInverse:function(t,i){var e=this.elements,r=t.elements,s=r[0],n=r[1],a=r[2],o=r[3],h=r[4],u=r[5],c=r[6],l=r[7],m=r[8],d=r[9],y=r[10],f=r[11],p=r[12],x=r[13],g=r[14],v=r[15],b=d*g*l-x*y*l+x*c*f-u*g*f-d*c*v+u*y*v,w=p*y*l-m*g*l-p*c*f+h*g*f+m*c*v-h*y*v,M=m*x*l-p*d*l+p*u*f-h*x*f-m*u*v+h*d*v,z=p*d*c-m*x*c-p*u*y+h*x*y+m*u*g-h*d*g,_=s*b+n*w+a*M+o*z;if(0===_){var A="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===i)throw new Error(A);return console.warn(A),this.identity()}var S=1/_;return e[0]=b*S,e[1]=(x*y*o-d*g*o-x*a*f+n*g*f+d*a*v-n*y*v)*S,e[2]=(u*g*o-x*c*o+x*a*l-n*g*l-u*a*v+n*c*v)*S,e[3]=(d*c*o-u*y*o-d*a*l+n*y*l+u*a*f-n*c*f)*S,e[4]=w*S,e[5]=(m*g*o-p*y*o+p*a*f-s*g*f-m*a*v+s*y*v)*S,e[6]=(p*c*o-h*g*o-p*a*l+s*g*l+h*a*v-s*c*v)*S,e[7]=(h*y*o-m*c*o+m*a*l-s*y*l-h*a*f+s*c*f)*S,e[8]=M*S,e[9]=(p*d*o-m*x*o-p*n*f+s*x*f+m*n*v-s*d*v)*S,e[10]=(h*x*o-p*u*o+p*n*l-s*x*l-h*n*v+s*u*v)*S,e[11]=(m*u*o-h*d*o-m*n*l+s*d*l+h*n*f-s*u*f)*S,e[12]=z*S,e[13]=(m*x*a-p*d*a+p*n*y-s*x*y-m*n*g+s*d*g)*S,e[14]=(p*u*a-h*x*a-p*n*c+s*x*c+h*n*g-s*u*g)*S,e[15]=(h*d*a-m*u*a+m*n*c-s*d*c-h*n*y+s*u*y)*S,this},scale:function(t){var i=this.elements,e=t.x,r=t.y,s=t.z;return i[0]*=e,i[4]*=r,i[8]*=s,i[1]*=e,i[5]*=r,i[9]*=s,i[2]*=e,i[6]*=r,i[10]*=s,i[3]*=e,i[7]*=r,i[11]*=s,this},getMaxScaleOnAxis:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,r))},makeTranslation:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var e=Math.cos(i),r=Math.sin(i),s=1-e,n=t.x,a=t.y,o=t.z,h=s*n,u=s*a;return this.set(h*n+e,h*a-r*o,h*o+r*a,0,h*a+r*o,u*a+e,u*o-r*n,0,h*o-r*a,u*o+r*n,s*o*o+e,0,0,0,0,1),this},makeScale:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this},makeShear:function(t,i,e){return this.set(1,i,e,0,t,1,e,0,t,i,1,0,0,0,0,1),this},compose:function(t,i,e){var r=this.elements,s=i._x,n=i._y,a=i._z,o=i._w,h=s+s,u=n+n,c=a+a,l=s*h,m=s*u,d=s*c,y=n*u,f=n*c,p=a*c,x=o*h,g=o*u,v=o*c,b=e.x,w=e.y,M=e.z;return r[0]=(1-(y+p))*b,r[1]=(m+v)*b,r[2]=(d-g)*b,r[3]=0,r[4]=(m-v)*w,r[5]=(1-(l+p))*w,r[6]=(f+x)*w,r[7]=0,r[8]=(d+g)*M,r[9]=(f-x)*M,r[10]=(1-(l+y))*M,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,i,e){var r=this.elements,s=G.set(r[0],r[1],r[2]).length(),n=G.set(r[4],r[5],r[6]).length(),a=G.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],Y.copy(this);var o=1/s,h=1/n,u=1/a;return Y.elements[0]*=o,Y.elements[1]*=o,Y.elements[2]*=o,Y.elements[4]*=h,Y.elements[5]*=h,Y.elements[6]*=h,Y.elements[8]*=u,Y.elements[9]*=u,Y.elements[10]*=u,i.setFromRotationMatrix(Y),e.x=s,e.y=n,e.z=a,this},makePerspective:function(t,i,e,r,s,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,o=2*s/(i-t),h=2*s/(e-r),u=(i+t)/(i-t),c=(e+r)/(e-r),l=-(n+s)/(n-s),m=-2*n*s/(n-s);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=m,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,i,e,r,s,n){var a=this.elements,o=1/(i-t),h=1/(e-r),u=1/(n-s),c=(i+t)*o,l=(e+r)*h,m=(n+s)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-l,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-m,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var i=this.elements,e=t.elements,r=0;r<16;r++)if(i[r]!==e[r])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var e=0;e<16;e++)this.elements[e]=t[e+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t[i+9]=e[9],t[i+10]=e[10],t[i+11]=e[11],t[i+12]=e[12],t[i+13]=e[13],t[i+14]=e[14],t[i+15]=e[15],t}});var it=new tt,et=new s;function rt(t,i,e,r){this._x=t||0,this._y=i||0,this._z=e||0,this._order=r||rt.DefaultOrder}function st(){this.mask=1}function nt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}rt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],rt.DefaultOrder="XYZ",Object.defineProperties(rt.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(rt.prototype,{isEuler:!0,set:function(t,i,e,r){return this._x=t,this._y=i,this._z=e,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,i,e){var s=r.clamp,n=t.elements,a=n[0],o=n[4],h=n[8],u=n[1],c=n[5],l=n[9],m=n[2],d=n[6],y=n[10];return"XYZ"===(i=i||this._order)?(this._y=Math.asin(s(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,y),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===i?(this._x=Math.asin(-s(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(h,y),this._z=Math.atan2(u,c)):(this._y=Math.atan2(-m,a),this._z=0)):"ZXY"===i?(this._x=Math.asin(s(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-m,y),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(u,a))):"ZYX"===i?(this._y=Math.asin(-s(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(d,y),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===i?(this._z=Math.asin(s(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-m,a)):(this._x=0,this._y=Math.atan2(h,y))):"XZY"===i?(this._z=Math.asin(-s(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(h,a)):(this._x=Math.atan2(-l,y),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this._order=i,!1!==e&&this._onChangeCallback(),this},setFromQuaternion:function(t,i,e){return it.makeRotationFromQuaternion(t),this.setFromRotationMatrix(it,i,e)},setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:function(t){return et.setFromEuler(this),this.setFromQuaternion(et,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new o(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(st.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(nt.prototype,{isMatrix3:!0,set:function(t,i,e,r,s,n,a,o,h){var u=this.elements;return u[0]=t,u[1]=r,u[2]=a,u[3]=i,u[4]=s,u[5]=o,u[6]=e,u[7]=n,u[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var i=this.elements,e=t.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this},setFromMatrix4:function(t){var i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var e=t.elements,r=i.elements,s=this.elements,n=e[0],a=e[3],o=e[6],h=e[1],u=e[4],c=e[7],l=e[2],m=e[5],d=e[8],y=r[0],f=r[3],p=r[6],x=r[1],g=r[4],v=r[7],b=r[2],w=r[5],M=r[8];return s[0]=n*y+a*x+o*b,s[3]=n*f+a*g+o*w,s[6]=n*p+a*v+o*M,s[1]=h*y+u*x+c*b,s[4]=h*f+u*g+c*w,s[7]=h*p+u*v+c*M,s[2]=l*y+m*x+d*b,s[5]=l*f+m*g+d*w,s[8]=l*p+m*v+d*M,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],e=t[1],r=t[2],s=t[3],n=t[4],a=t[5],o=t[6],h=t[7],u=t[8];return i*n*u-i*a*h-e*s*u+e*a*o+r*s*h-r*n*o},getInverse:function(t,i){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var e=t.elements,r=this.elements,s=e[0],n=e[1],a=e[2],o=e[3],h=e[4],u=e[5],c=e[6],l=e[7],m=e[8],d=m*h-u*l,y=u*c-m*o,f=l*o-h*c,p=s*d+n*y+a*f;if(0===p){var x="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===i)throw new Error(x);return console.warn(x),this.identity()}var g=1/p;return r[0]=d*g,r[1]=(a*l-m*n)*g,r[2]=(u*n-a*h)*g,r[3]=y*g,r[4]=(m*s-a*c)*g,r[5]=(a*o-u*s)*g,r[6]=f*g,r[7]=(n*c-l*s)*g,r[8]=(h*s-n*o)*g,this},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},setUvTransform:function(t,i,e,r,s,n,a){var o=Math.cos(s),h=Math.sin(s);this.set(e*o,e*h,-e*(o*n+h*a)+n+t,-r*h,r*o,-r*(-h*n+o*a)+a+i,0,0,1)},scale:function(t,i){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=i,e[4]*=i,e[7]*=i,this},rotate:function(t){var i=Math.cos(t),e=Math.sin(t),r=this.elements,s=r[0],n=r[3],a=r[6],o=r[1],h=r[4],u=r[7];return r[0]=i*s+e*o,r[3]=i*n+e*h,r[6]=i*a+e*u,r[1]=-e*s+i*o,r[4]=-e*n+i*h,r[7]=-e*a+i*u,this},translate:function(t,i){var e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=i*e[2],e[4]+=i*e[5],e[7]+=i*e[8],this},equals:function(t){for(var i=this.elements,e=t.elements,r=0;r<9;r++)if(i[r]!==e[r])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var e=0;e<9;e++)this.elements[e]=t[e+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t}});var at=0,ot=new o,ht=new s,ut=new tt,ct=new o,lt=new o,mt=new o,dt=new s,yt=new o(1,0,0),ft=new o(0,1,0),pt=new o(0,0,1),xt={type:"added"},gt={type:"removed"};function vt(){Object.defineProperty(this,"id",{value:at++}),this.uuid=r.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=vt.DefaultUp.clone();var t=new o,i=new rt,e=new s,n=new o(1,1,1);i._onChange((function(){e.setFromEuler(i,!1)})),e._onChange((function(){i.setFromQuaternion(e,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:e},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new tt},normalMatrix:{value:new nt}}),this.matrix=new tt,this.matrixWorld=new tt,this.matrixAutoUpdate=vt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new st,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}vt.DefaultUp=new o(0,1,0),vt.DefaultMatrixAutoUpdate=!0,vt.prototype=Object.assign(Object.create(z.prototype),{constructor:vt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,i){return ht.setFromAxisAngle(t,i),this.quaternion.multiply(ht),this},rotateOnWorldAxis:function(t,i){return ht.setFromAxisAngle(t,i),this.quaternion.premultiply(ht),this},rotateX:function(t){return this.rotateOnAxis(yt,t)},rotateY:function(t){return this.rotateOnAxis(ft,t)},rotateZ:function(t){return this.rotateOnAxis(pt,t)},translateOnAxis:function(t,i){return ot.copy(t).applyQuaternion(this.quaternion),this.position.add(ot.multiplyScalar(i)),this},translateX:function(t){return this.translateOnAxis(yt,t)},translateY:function(t){return this.translateOnAxis(ft,t)},translateZ:function(t){return this.translateOnAxis(pt,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(ut.getInverse(this.matrixWorld))},lookAt:function(t,i,e){t.isVector3?ct.copy(t):ct.set(t,i,e);var r=this.parent;this.updateWorldMatrix(!0,!1),lt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ut.lookAt(lt,ct,this.up):ut.lookAt(ct,lt,this.up),this.quaternion.setFromRotationMatrix(ut),r&&(ut.extractRotation(r.matrixWorld),ht.setFromRotationMatrix(ut),this.quaternion.premultiply(ht.inverse()))},add:function(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(xt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}var e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(gt)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),ut.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ut.multiply(t.parent.matrixWorld)),t.applyMatrix4(ut),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,i){if(this[t]===i)return this;for(var e=0,r=this.children.length;e<r;e++){var s=this.children[e].getObjectByProperty(t,i);if(void 0!==s)return s}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new o),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new s),this.updateMatrixWorld(!0),this.matrixWorld.decompose(lt,t,mt),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new o),this.updateMatrixWorld(!0),this.matrixWorld.decompose(lt,dt,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new o),this.updateMatrixWorld(!0);var i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var i=this.children,e=0,r=i.length;e<r;e++)i[e].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var i=this.children,e=0,r=i.length;e<r;e++)i[e].traverseVisible(t)}},traverseAncestors:function(t){var i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var i=this.children,e=0,r=i.length;e<r;e++)i[e].updateMatrixWorld(t)},updateWorldMatrix:function(t,i){var e=this.parent;if(!0===t&&null!==e&&e.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i)for(var r=this.children,s=0,n=r.length;s<n;s++)r[s].updateWorldMatrix(!1,!0)},toJSON:function(t){var i=void 0===t||"string"==typeof t,e={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function s(i,e){return void 0===i[e.uuid]&&(i[e.uuid]=e.toJSON(t)),e.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=s(t.geometries,this.geometry);var n=this.geometry.parameters;if(void 0!==n&&void 0!==n.shapes){var a=n.shapes;if(Array.isArray(a))for(var o=0,h=a.length;o<h;o++){var u=a[o];s(t.shapes,u)}else s(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(o=0,h=this.material.length;o<h;o++)c.push(s(t.materials,this.material[o]));r.material=c}else r.material=s(t.materials,this.material);if(this.children.length>0){r.children=[];for(o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(t).object)}if(i){var l=f(t.geometries),m=f(t.materials),d=f(t.textures),y=f(t.images);a=f(t.shapes);l.length>0&&(e.geometries=l),m.length>0&&(e.materials=m),d.length>0&&(e.textures=d),y.length>0&&(e.images=y),a.length>0&&(e.shapes=a)}return e.object=r,e;function f(t){var i=[];for(var e in t){var r=t[e];delete r.metadata,i.push(r)}return i}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(var e=0;e<t.children.length;e++){var r=t.children[e];this.add(r.clone())}return this}});var bt=1,wt=new tt,Mt=new vt,zt=new o,_t=new w,At=new w,St=new o;function Et(){Object.defineProperty(this,"id",{value:bt+=2}),this.uuid=r.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function kt(t,i,e,r,s,n,a,h){Et.call(this),this.type="TerrainTileGeometry";const u=e,c=r,l=u+1,m=c+1,d=t/u,y=i/c,f=[],p=[],x=[];var g,v,b=1/0,M=-1/0;void 0===a.dtmWidth&&(a.dtmWidth=a.terrainWidth+1);const z=l+a.left,_=m+a.top,A=h.z,S=h.x;var E,k,T=h.y;for(v=a.top;v<_;v++){for(k=S,E=v*a.dtmWidth+a.left+a.dtmOffset,g=a.left;g<z;g++){const t=s[E++]/n-A;p.push(k,T,t),t<b&&(b=t),t>M&&(M=t),x.push(g/a.terrainWidth),x.push(1-v/a.terrainHeight),k+=d}T-=y}for(this.boundingBox=(new w).set(new o(h.x,h.y-i,b),new o(h.x+t,h.y,M)),v=0;v<c;v++)for(g=0;g<u;g++){const t=g+l*v,i=g+l*(v+1),e=g+1+l*(v+1),r=g+1+l*v;Math.abs(p[3*t+2]-p[3*r+2])<Math.abs(p[3*i+2]-p[3*e+2])?(f.push(t,i,r),f.push(i,e,r)):(f.push(t,i,e),f.push(e,r,t))}this.setIndex(f),this.setAttribute("position",new P(p,3)),this.setAttribute("uv",new P(x,2)),this.computeVertexNormals()}function Tt(t,i,e,r,s){Et.call(this),this.type="FlatTileGeometry";const n=[],a=[];n.push(r.x,r.y-i,s),n.push(r.x,r.y,s),n.push(r.x+t,r.y,s),n.push(r.x+t,r.y-i,s),a.push(e.left/e.terrainWidth,e.bottom/e.terrainHeight),a.push(e.left/e.terrainWidth,1-e.top/e.terrainHeight),a.push(1-e.right/e.terrainWidth,1-e.top/e.terrainHeight),a.push(1-e.right/e.terrainWidth,e.bottom/e.terrainHeight),this.boundingBox=(new w).set(new o(r.x,r.y-i,0),new o(r.x+t,r.y,0)),this.setIndex([0,2,1,0,3,2]),this.setAttribute("position",new P(n,3)),this.setAttribute("uv",new P(a,2)),this.computeVertexNormals()}Et.prototype=Object.assign(Object.create(z.prototype),{constructor:Et,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(function(t){if(0===t.length)return-1/0;for(var i=t[0],e=1,r=t.length;e<r;++e)t[e]>i&&(i=t[e]);return i}(t)>65535?W:j)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,i){return this.attributes[t]=i,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,i,e){this.groups.push({start:t,count:i,materialIndex:void 0!==e?e:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},applyMatrix4:function(t){var i=this.attributes.position;void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0);var e=this.attributes.normal;if(void 0!==e){var r=(new nt).getNormalMatrix(t);e.applyNormalMatrix(r),e.needsUpdate=!0}var s=this.attributes.tangent;return void 0!==s&&(s.transformDirection(t),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return wt.makeRotationX(t),this.applyMatrix4(wt),this},rotateY:function(t){return wt.makeRotationY(t),this.applyMatrix4(wt),this},rotateZ:function(t){return wt.makeRotationZ(t),this.applyMatrix4(wt),this},translate:function(t,i,e){return wt.makeTranslation(t,i,e),this.applyMatrix4(wt),this},scale:function(t,i,e){return wt.makeScale(t,i,e),this.applyMatrix4(wt),this},lookAt:function(t){return Mt.lookAt(t),Mt.updateMatrix(),this.applyMatrix4(Mt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(zt).negate(),this.translate(zt.x,zt.y,zt.z),this},setFromObject:function(t){var i=t.geometry;if(t.isPoints||t.isLine){var e=new P(3*i.vertices.length,3),r=new P(3*i.colors.length,3);if(this.setAttribute("position",e.copyVector3sArray(i.vertices)),this.setAttribute("color",r.copyColorsArray(i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){var s=new P(i.lineDistances.length,1);this.setAttribute("lineDistance",s.copyArray(i.lineDistances))}null!==i.boundingSphere&&(this.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(this.boundingBox=i.boundingBox.clone())}else t.isMesh&&i&&i.isGeometry&&this.fromGeometry(i);return this},setFromPoints:function(t){for(var i=[],e=0,r=t.length;e<r;e++){var s=t[e];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new P(i,3)),this},updateFromObject:function(t){var i,e=t.geometry;if(t.isMesh){var r=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(r=void 0,e.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(e);r.verticesNeedUpdate=e.verticesNeedUpdate,r.normalsNeedUpdate=e.normalsNeedUpdate,r.colorsNeedUpdate=e.colorsNeedUpdate,r.uvsNeedUpdate=e.uvsNeedUpdate,r.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=r}return!0===e.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(e.vertices),i.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(e.normals),i.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(e.colors),i.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(e.uvs),i.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(e.lineDistances),i.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new X).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var i=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new N(i,3).copyVector3sArray(t.vertices)),t.normals.length>0){var e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new N(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(3*t.colors.length);this.setAttribute("color",new N(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var s=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new N(s,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var n=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new N(n,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var o=[],h=t.morphTargets[a],u=0,c=h.length;u<c;u++){var l=h[u],m=new P(3*l.data.length,3);m.name=l.name,o.push(m.copyVector3sArray(l.data))}this.morphAttributes[a]=o}if(t.skinIndices.length>0){var d=new P(4*t.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var y=new P(4*t.skinWeights.length,4);this.setAttribute("skinWeight",y.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new w);var t=this.attributes.position,i=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(var e=0,r=i.length;e<r;e++){var s=i[e];_t.setFromBufferAttribute(s),this.morphTargetsRelative?(St.addVectors(this.boundingBox.min,_t.min),this.boundingBox.expandByPoint(St),St.addVectors(this.boundingBox.max,_t.max),this.boundingBox.expandByPoint(St)):(this.boundingBox.expandByPoint(_t.min),this.boundingBox.expandByPoint(_t.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Z);var t=this.attributes.position,i=this.morphAttributes.position;if(t){var e=this.boundingSphere.center;if(_t.setFromBufferAttribute(t),i)for(var r=0,s=i.length;r<s;r++){var n=i[r];At.setFromBufferAttribute(n),this.morphTargetsRelative?(St.addVectors(_t.min,At.min),_t.expandByPoint(St),St.addVectors(_t.max,At.max),_t.expandByPoint(St)):(_t.expandByPoint(At.min),_t.expandByPoint(At.max))}_t.getCenter(e);var a=0;for(r=0,s=t.count;r<s;r++)St.fromBufferAttribute(t,r),a=Math.max(a,e.distanceToSquared(St));if(i)for(r=0,s=i.length;r<s;r++){n=i[r];for(var o=this.morphTargetsRelative,h=0,u=n.count;h<u;h++)St.fromBufferAttribute(n,h),o&&(zt.fromBufferAttribute(t,h),St.add(zt)),a=Math.max(a,e.distanceToSquared(St))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,i=this.attributes;if(i.position){var e=i.position.array;if(void 0===i.normal)this.setAttribute("normal",new N(new Float32Array(e.length),3));else for(var r=i.normal.array,s=0,n=r.length;s<n;s++)r[s]=0;var a,h,u,c=i.normal.array,l=new o,m=new o,d=new o,y=new o,f=new o;if(t){var p=t.array;for(s=0,n=t.count;s<n;s+=3)a=3*p[s+0],h=3*p[s+1],u=3*p[s+2],l.fromArray(e,a),m.fromArray(e,h),d.fromArray(e,u),y.subVectors(d,m),f.subVectors(l,m),y.cross(f),c[a]+=y.x,c[a+1]+=y.y,c[a+2]+=y.z,c[h]+=y.x,c[h+1]+=y.y,c[h+2]+=y.z,c[u]+=y.x,c[u+1]+=y.y,c[u+2]+=y.z}else for(s=0,n=e.length;s<n;s+=9)l.fromArray(e,s),m.fromArray(e,s+3),d.fromArray(e,s+6),y.subVectors(d,m),f.subVectors(l,m),y.cross(f),c[s]=y.x,c[s+1]=y.y,c[s+2]=y.z,c[s+3]=y.x,c[s+4]=y.y,c[s+5]=y.z,c[s+6]=y.x,c[s+7]=y.y,c[s+8]=y.z;this.normalizeNormals(),i.normal.needsUpdate=!0}},merge:function(t,i){if(t&&t.isBufferGeometry){void 0===i&&(i=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var e=this.attributes;for(var r in e)if(void 0!==t.attributes[r])for(var s=e[r].array,n=t.attributes[r],a=n.array,o=n.itemSize*i,h=Math.min(a.length,s.length-o),u=0,c=o;u<h;u++,c++)s[c]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,i=0,e=t.count;i<e;i++)St.x=t.getX(i),St.y=t.getY(i),St.z=t.getZ(i),St.normalize(),t.setXYZ(i,St.x,St.y,St.z)},toNonIndexed:function(){function t(t,i){for(var e=t.array,r=t.itemSize,s=new e.constructor(i.length*r),n=0,a=0,o=0,h=i.length;o<h;o++){n=i[o]*r;for(var u=0;u<r;u++)s[a++]=e[n++]}return new N(s,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var i=new Et,e=this.index.array,r=this.attributes;for(var s in r){var n=t(r[s],e);i.setAttribute(s,n)}var a=this.morphAttributes;for(s in a){for(var o=[],h=a[s],u=0,c=h.length;u<c;u++){n=t(h[u],e);o.push(n)}i.morphAttributes[s]=o}i.morphTargetsRelative=this.morphTargetsRelative;for(var l=this.groups,m=(u=0,l.length);u<m;u++){var d=l[u];i.addGroup(d.start,d.count,d.materialIndex)}return i},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var i=this.parameters;for(var e in i)void 0!==i[e]&&(t[e]=i[e]);return t}t.data={attributes:{}};var r=this.index;null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var s=this.attributes;for(var e in s){var n=(m=s[e]).toJSON();""!==m.name&&(n.name=m.name),t.data.attributes[e]=n}var a={},o=!1;for(var e in this.morphAttributes){for(var h=this.morphAttributes[e],u=[],c=0,l=h.length;c<l;c++){var m;n=(m=h[c]).toJSON();""!==m.name&&(n.name=m.name),u.push(n)}u.length>0&&(a[e]=u,o=!0)}o&&(t.data.morphAttributes=a,t.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));var y=this.boundingSphere;return null!==y&&(t.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),t},clone:function(){return(new Et).copy(this)},copy:function(t){var i,e,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.index;null!==s&&this.setIndex(s.clone());var n=t.attributes;for(i in n){var a=n[i];this.setAttribute(i,a.clone())}var o=t.morphAttributes;for(i in o){var h=[],u=o[i];for(e=0,r=u.length;e<r;e++)h.push(u[e].clone());this.morphAttributes[i]=h}this.morphTargetsRelative=t.morphTargetsRelative;var c=t.groups;for(e=0,r=c.length;e<r;e++){var l=c[e];this.addGroup(l.start,l.count,l.materialIndex)}var m=t.boundingBox;null!==m&&(this.boundingBox=m.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),kt.prototype=Object.create(Et.prototype),Tt.prototype=Object.create(Et.prototype);const Bt=6378137*Math.PI;var Ot;function Ct(t){var i,e=Ot.tileSet;if("dzz"===e.encoding){const r=e.divisions+1;i=function(t,i){const e=new Uint8Array(t),r=new Uint32Array(i);if(4===e.length)return r;var s,n=0,a=0;for(s=0;s<e.length;s++){for(var o=0,h=0,u=e[s];128&u;)o|=(127&u)<<h,h+=7,u=e[++s];n+=1&(o|=u<<h)?o>>1^-1:o>>1,r[a++]=n}return r}(t,r*r)}else i=new Uint16Array(t);switch(Ot.request){case"tile":!function(t){const i=Ot.clip,e=Ot.offsets,r=Ot.tileSet,s=Ot.divisions,n=s-i.left-i.right,a=s-i.top-i.bottom,o=Ot.resolution,h=o*n,u=o*a;var c;i.terrainHeight=s,i.terrainWidth=s,e.x=o*(Ot.x*s+i.left)-Bt-e.x,e.y=Bt-o*(Ot.y*s+i.top)-e.y,c=r.isFlat?new Tt(h,u,i,e,Ot.flatZ):new kt(h,u,n,a,t,r.dtmScale,i,e);const l=c.boundingBox,m={min:{x:l.min.x,y:l.min.y,z:l.min.z},max:{x:l.max.x,y:l.max.y,z:l.max.z}},d=c.index.array.buffer,y={},f=[],p=c.attributes;for(var x in p){const t=p[x],i=t.array.buffer;y[x]={array:i,itemSize:t.itemSize},f.push(i)}postMessage({status:"ok",index:d,attributes:y,boundingBox:m},f)}(i);break;case"height":!function(t){const i=Ot.dataOffsets,e=Ot.points,r=i.length;var s;for(s=0;s<r;s++)e[s].z=t[i[s]]/Ot.tileSet.dtmScale;postMessage({status:"ok",points:e})}(i);break;default:console.log("webTileWorker: unknown request type"),Rt()}}function Rt(){postMessage({status:"nomap"})}onmessage=function(i){(Ot=i.data).tileSet.isFlat?Ct(null):new t(Ot,Ct,Rt).load()}}));
